#!/usr/bin/env ruby
require "yaml"
require "brpm_auto"

params = {}
params["log_file"] = "/tmp/brpm_install.log"
params["also_log_to_console"] = "true"

begin
  BrpmAuto.setup(params)

  if ARGV.size < 1
    BrpmAuto.log "Missing arguments."
    BrpmAuto.log "Usage: \n  brpm_install <module name> [<module version>]\n  brpm_install <path to module>"
    abort("Missing arguments")
  end

  module_name_or_path = ARGV[0]
  module_version = ARGV[1] # optional

  BrpmAuto.log "Installing module #{module_name_or_path}#{module_version.nil? ? "" : " " + module_version}..."
  module_installer = ModuleInstaller.new
  module_installer.install_module(module_name_or_path, module_version)

rescue Exception => e
  BrpmAuto.log_error "#{e}"
  BrpmAuto.log "\n\t" + e.backtrace.join("\n\t")

  raise e
end