#!/usr/bin/env ruby
require "yaml"
require "brpm_auto"

params = {}
params["log_file"] = "/tmp/brpm_install.log"
params["also_log_to_console"] = "true"

begin
  BrpmAuto.setup(params)

  if ARGV.size < 2
    BrpmAuto.log "Missing arguments."
    BrpmAuto.log "Usage: \n  brpm_uninstall <module name> <module version>"
    abort("Missing arguments")
  end

  module_name = ARGV[0]
  module_version = ARGV[1] # optional

  BrpmAuto.log "Uninstalling module #{module_name} #{module_version}..."
  module_installer = ModuleInstaller.new
  module_installer.uninstall_module(module_name, module_version)

rescue Exception => e
  BrpmAuto.log_error "#{e}"
  BrpmAuto.log "\n\t" + e.backtrace.join("\n\t")

  raise e
end